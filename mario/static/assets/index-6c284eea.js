var $e=Object.defineProperty;var Ae=(n,t,r)=>t in n?$e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var M=(n,t,r)=>(Ae(n,typeof t!="symbol"?t+"":t,r),r);import{j as z,r as g,u as ve,a as qe,F as Me,b as _e,c as Fe,d as Ue,e as je,f as Ke,g as Ve,h as Qe,P as We,D as Xe,i as Be,k as Ge,A as C,I as w,l as Y,m as He,n as N,o as ze,U as v,p as S,q as be,s as xe,t as m,v as A,_ as Ye,W as J,$ as k,L as $,C as Je,X as Ze,S as et,w as tt,N as nt,E as rt,x as we,y as Ne,z as Z,B as Ce,G as ee,H as te,Z as ne,J as O,K as P,M as re,Q as R,O as D,R as st,T as it,V as Le,Y as at,a0 as ot,a1 as ct,a2 as se,a3 as F,a4 as Pe,a5 as he,a6 as lt,a7 as me,a8 as pe,a9 as Re,aa as dt,ab as ut,ac as ht,ad as mt,ae as pt,af as gt,ag as ft,ah as yt,ai as vt,aj as bt}from"./vendor-ccd85f8c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();const T=z.Fragment,e=z.jsx,i=z.jsxs;class xt extends Error{constructor(r,o){const s=r.status||r.status===0?r.status:"",a=r.statusText||"",c=`${s} ${a}`.trim(),u=c?`status code ${c}`:"an unknown error";super(`Request failed with ${u}`);M(this,"response");M(this,"request");this.name="HTTPError",this.response=r,this.request=o}}const wt=n=>{const t=new URLSearchParams;return Object.entries(n).forEach(([r,o])=>{o!==void 0&&t.set(r,o)}),t};class Nt{constructor(t={}){M(this,"config");var r;this.config=t,this.config.baseUrl=(r=this.config.baseUrl)==null?void 0:r.replace(/\/+$/,"")}get baseUrl(){return this.config.baseUrl}async fetch(t){let r,o;if(typeof t=="string")r=t;else{const{url:c,params:u,json:h,...d}=t;if(r=c,o=d,h&&(o.body=JSON.stringify(h),o.headers={"Content-Type":"application/json"}),u){const f=wt(u);r+=`?${f}`}}this.config.baseUrl&&(r=this.config.baseUrl+r);const s=new Request(r,{...o,credentials:"include"}),a=await fetch(s);if(!a.ok)throw new xt(a,s);return a.headers.get("Content-Type")==="application/json"?await a.json():await a.text()}async fetchForceMethod(t,r){return typeof t=="string"?this.fetch({url:t,method:r}):this.fetch({...t,method:r})}async get(t){return this.fetchForceMethod(t,"get")}async post(t){return this.fetchForceMethod(t,"post")}async put(t){return this.fetchForceMethod(t,"put")}async patch(t){return this.fetchForceMethod(t,"patch")}async delete(t){return this.fetchForceMethod(t,"delete")}}const Ct=`${window.location.protocol}//${window.location.host}/api`,K={}.VITE_API_BASE_URL||Ct,L=new Nt({baseUrl:K}),Lt=()=>L.baseUrl,Pt=async()=>await L.get("/whoami"),Rt=async()=>{await L.post("/logout")},ie=()=>{const n=new URL(K);return n.protocol="ws",n.pathname+="/ws",n},St=async()=>await L.get("/pipelines"),ae=async n=>await L.get(`/pipelines/${n}`),Tt=async n=>await L.get(`/pipelines/${n}/input-schema`),oe=async(n,t)=>{const r={pipeline_id:n,trigger_id:t},o=await L.get({url:"/runs",params:r});return o.forEach(s=>{s.start_time=new Date(s.start_time)}),o},kt=async n=>{const t=await L.get(`/runs/${n}`);return t.start_time=new Date(t.start_time),t},Ot=async n=>(await L.get(`/runs/${n}/logs`)).split(`
`).map((r,o)=>{const s=JSON.parse(r);return s.id=o,s.timestamp=new Date(s.timestamp),s}),Dt=async(n,t)=>await L.get(`/runs/${n}/data/${t}`),B=n=>`${K}/pipelines/${n}/run`,Et=n=>({async mutationFn(t){L.post({url:`/pipelines/${n}/run`,json:t})}}),_=(n,t,r=!0)=>`${r?K:""}/pipelines/${n}/triggers/${t}/run`,It=async(n,t)=>await L.post(_(n,t,!1)),Se=g.createContext({isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{},user:null}),$t=(n,t)=>{switch(t.type){case"LOGIN":return{...n,isAuthenticated:!0,isAuthenticationEnabled:t.payload.isAuthenticationEnabled,user:t.payload.user};case"LOGOUT":return{...n,isAuthenticated:!1,user:null};case"POPULATE":return{...n,user:t.payload?{...n.user,...t.payload}:null};case"STOP_LOADING":return{...n,isLoading:!1};default:throw new Error("Unknown action type")}},At=({children:n})=>{const[t,r]=g.useReducer($t,{isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{await Rt(),r({type:"LOGOUT"})},user:null});return g.useEffect(()=>{(async()=>{try{const{is_authentication_enabled:s,user:a}=await Pt();(s&&a||!s)&&r({type:"LOGIN",payload:{user:a,isAuthenticationEnabled:s}})}catch(s){console.error(s)}finally{r({type:"STOP_LOADING"})}})()},[]),e(Se.Provider,{value:t,children:t.isAuthenticationEnabled&&t.isLoading?"Loading...":n})},ce=()=>g.useContext(Se),qt=n=>`translate${n==="bottom"||n==="top"?"Y":"X"}(${n==="bottom"||n==="right"?"-":"+"}10%)`;function Mt({initialOpen:n=!1,placement:t="bottom",modal:r,open:o,onOpenChange:s}={}){const[a,c]=g.useState(n),[u,h]=g.useState(),[d,f]=g.useState(),l=o??a,y=s??c,x=Ue({placement:t,open:l,onOpenChange:y,whileElementsMounted:We,middleware:[Xe(5),Be({fallbackAxisSideDirection:"end"}),Ge({padding:5})]}),p=x.context,b=je(p,{enabled:o==null}),E=Ke(p),X=Ve(p),q=Qe([b,E,X]);return g.useMemo(()=>({open:l,setOpen:y,...q,...x,modal:r,labelId:u,descriptionId:d,setLabelId:h,setDescriptionId:f}),[l,y,q,x,r,u,d])}const Te=g.createContext(null),V=()=>{const n=g.useContext(Te);if(n==null)throw new Error("Popover components must be wrapped in <Popover />");return n};function _t({children:n,modal:t=!0,...r}){const o=Mt({modal:t,...r});return e(Te.Provider,{value:o,children:n})}const Ft=g.forwardRef(function({children:t,asChild:r=!1,...o},s){const a=V(),c=t.ref,u=ve([a.refs.setReference,s,c]);return r&&g.isValidElement(t)?g.cloneElement(t,a.getReferenceProps({ref:u,...o,...t.props,"data-state":a.open?"open":"closed"})):e("button",{ref:u,type:"button","data-state":a.open?"open":"closed",...a.getReferenceProps(o),children:t})}),Ut=g.forwardRef(function(t,r){const{context:o,...s}=V(),a=ve([s.refs.setFloating,r]),{isMounted:c,styles:u}=qe(o,{initial:({side:h})=>({opacity:0,transform:qt(h)})});return e(Me,{children:c&&e(_e,{context:o,modal:s.modal,children:e("div",{ref:a,style:{position:s.strategy,top:s.y??0,left:s.x??0,width:"max-content",...t.style,...u},"aria-labelledby":s.labelId,"aria-describedby":s.descriptionId,...s.getFloatingProps(t),children:t.children})})})});g.forwardRef(function({children:t,...r},o){const{setDescriptionId:s}=V(),a=Fe();return g.useLayoutEffect(()=>(s(a),()=>s(void 0)),[a,s]),e("p",{...r,ref:o,id:a,children:t})});g.forwardRef(function(t,r){const{setOpen:o}=V();return e("button",{type:"button",ref:r,...t,onClick:s=>{var a;(a=t.onClick)==null||a.call(t,s),o(!1)}})});const jt=()=>{const{logout:n,user:t}=ce();if(!t)return e("div",{children:"Not logged in"});const r=t.name.split(" "),o=r.length>1?`${r.at(0)[0]}${r.at(-1)[0]}`:r[0];return i(_t,{placement:"bottom-start",children:[e(Ft,{children:e("div",{className:"flex justify-center items-center font-medium bg-white ring-1 ring-slate-200 text-indigo-500 rounded-full ml-4 hover:ring-2 transition-shadow",style:{width:34,height:34},children:o})}),e(Ut,{children:i(C,{className:"shadow-xl",children:[e(w,{children:t.name}),e(Y,{children:t.email}),e(He,{}),e(N,{size:"xs",variant:"secondary",color:"rose",icon:ze,className:"w-full",onClick:async()=>await n(),children:"Logout"})]})})]})},Q=({children:n,header:t})=>{const{isAuthenticated:r,isAuthenticationEnabled:o}=ce();return i("div",{className:"bg-slate-50 p-6 sm:p-10 min-h-screen",children:[i(v,{className:"items-start",children:[t&&e("div",{className:"flex-grow",children:t}),r&&o&&e(jt,{})]}),e("main",{children:n})]})},W=({children:n,footer:t,isOpen:r,maxHeight:o,maxWidth:s="600px",minWidth:a="350px",subtitle:c,title:u,onClose:h})=>{const d=g.createRef();return g.useEffect(()=>{var l,y;r?(l=d.current)==null||l.showModal():(y=d.current)==null||y.close()},[r]),e("dialog",{ref:d,style:{padding:0,background:"transparent",overflow:"visible",maxHeight:o,maxWidth:s,minWidth:a},onClick:l=>{var p;var y=d.current.getBoundingClientRect(),x=y.top<=l.clientY&&l.clientY<=y.top+y.height&&y.left<=l.clientX&&l.clientX<=y.left+y.width;x||(h?h():(p=d.current)==null||p.close())},children:i(C,{children:[u&&e(w,{children:u}),c&&e(Y,{children:c}),e("div",{className:(u||c)&&"mt-6",children:n}),t&&e(v,{className:"justify-end space-x-6 mt-6",children:t})]})})},Kt=n=>{const t=s=>{if(!n.definitions)return;const a=s.split("/").pop();return n.definitions[a]},r=n.properties;if(!r)return e(m,{className:"mt-4",children:"This pipeline has no input"});const o=Object.entries(r).map(([s,a])=>{var l,y,x;if(typeof a=="boolean")return;let c=a,u;if(a.allOf){const p=a.allOf[0];if(u=(l=a.default)==null?void 0:l.toString(),p.$ref){const b=t(p.$ref);b&&(c=b)}}else if(a.$ref){const p=t(a.$ref);p&&(c=p)}else u=(y=c.default)==null?void 0:y.toString();const h=c.title||s,d=(c.enum?"enum":Array.isArray(c.type)?c.type[0]:c.type)||"string",f=(x=n.required)==null?void 0:x.includes(s);if(["number","integer"].includes(d)){const p=c.minimum||c.exclusiveMinimum,b=c.maximum||c.exclusiveMaximum;if(p!==void 0&&b!==void 0){const E=g.createRef(),X=d==="number"?(b-p)/10:1;return i("div",{children:[e(m,{children:h}),e("input",{name:s,type:"range",min:p,max:b,step:X,defaultValue:u,required:f,onInput:q=>E.current&&(E.current.value=q.target.value),className:"w-full mt-2 cursor-ew-resize appearance-none h-2 bg-slate-200 border border-slate-400 rounded"}),i(v,{className:"items-baseline space-x-4",children:[i("div",{className:"ml-1",children:[e("div",{className:"border-r border-slate-300 h-2 w-1"}),e(m,{children:p})]}),e(m,{children:e(A,{children:e("output",{ref:E,className:"px-2 py-1 rounded bg-slate-200 block truncate text-center",children:u})})}),i("div",{className:"mr-1",children:[e("div",{className:"border-r border-slate-300 h-2 w-1"}),e(m,{children:b})]})]})]},s)}else return i("div",{children:[e(m,{children:h}),e("input",{name:s,type:"number",min:p,max:b,defaultValue:u,className:"border-gray-300 rounded-md border shadow-sm px-4 py-2 text-sm font-medium invalid:border-rose-500 mt-2",style:{textAlign:"end",width:"100%"},required:f})]},s)}else return d==="enum"?i("div",{children:[e(m,{children:h}),i("select",{name:s,defaultValue:u||"",className:"border-gray-300 rounded-md border shadow-sm px-4 py-2 text-sm font-medium w-full invalid:border-rose-500 mt-2",required:f,children:[e("option",{disabled:!0,value:"",children:"Select..."}),c.enum.map(p=>e("option",{value:p.toString(),children:p==null?void 0:p.toString()},p==null?void 0:p.toString()))]})]},s):i("div",{children:[i(m,{children:[h," ",f&&"*"]}),e(Ye,{name:s,placeholder:h,defaultValue:u,className:"mt-2"})]},s)});return e("div",{className:"space-y-4",children:o})},le=({pipeline:n})=>{const[t,r]=g.useState(!1),o=S({queryKey:["pipeline-input",n.id],queryFn:()=>Tt(n.id),enabled:t}),s=be(Et(n.id));return i(T,{children:[e(N,{color:"indigo",variant:"secondary",size:"xs",icon:xe,onClick:()=>r(!0),children:"Run pipeline"}),e(W,{isOpen:t,title:`Run ${n.name} manually`,onClose:()=>r(!1),children:i("form",{method:"dialog",onSubmit:a=>{const c=Object.fromEntries(new FormData(a.target).entries());s.mutateAsync(c)},children:[o.isLoading?"Loading...":e("div",{style:{width:350},children:Kt(o.data)}),i(v,{className:"justify-end space-x-6 mt-6",children:[e(N,{variant:"secondary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),e(N,{color:"indigo",type:"submit",children:"Run"})]})]})})]})},Vt=()=>{const n=S({queryKey:["pipelines"],queryFn:St,initialData:[]});if(n.isLoading)return e("div",{children:"Loading..."});if(n.error)return e("div",{children:"An error has occurred"});const t=n.data;return i(C,{children:[e(w,{children:"Pipelines"}),e(J,{children:t.map(r=>i(k,{children:[i("div",{children:[e(m,{children:e(A,{children:e($,{to:`/pipelines/${r.id}`,children:r.name})})}),r.description&&e(m,{className:"truncate",children:r.description})]}),e(le,{pipeline:r})]},r.id))})]})},U={completed:"emerald",failed:"rose",cancelled:"slate",running:"blue",notrun:"slate",warning:"amber"},G={completed:Je,failed:Ze,cancelled:et,running:tt,notrun:nt,warning:rt},H=["cyan","violet","pink","emerald","orange","stone","fuchsia"],ke=n=>Object.fromEntries(n.map((t,r)=>[t.id,`bg-${H[r%H.length]}-500`])),Qt=n=>we(n).format("D MMM YYYY HH:mm:ss (Z[Z])"),Wt=n=>we(n).format("HH:mm:ss.SSS"),Oe=({status:n})=>e(Ne,{color:U[n],icon:G[n],children:n}),Xt=({startTime:n})=>{const[t,r]=g.useState(Date.now()-n.getTime());return g.useEffect(()=>{const o=setInterval(()=>{r(Date.now()-n.getTime())},500);return()=>{clearInterval(o)}}),e("span",{children:(t/1e3).toFixed(2)})},de=({pipelineId:n,runs:t,triggerId:r})=>{const[o,s]=g.useState(t),a=Z(),c=Ce(),{lastJsonMessage:u}=ee(ie().toString()),h=g.useCallback(d=>{const{data:f,type:l}=d;if(l==="run-update")if(f.run.start_time=new Date(f.run.start_time),f.run.trigger_id=f.trigger,f.run.status==="running")s([f.run,...o]);else{let y=[...o];const x=y.findIndex(p=>p.id===f.run.id);x>=0?y[x]=f.run:y=[f.run,...y],s(y),a.invalidateQueries({queryKey:["runs",n,r]})}},[n,a,o,r]);return g.useEffect(()=>{u&&h(u)},[u]),g.useEffect(()=>{t.length&&s(t)},[t]),i(C,{children:[e(w,{children:"Runs"}),i(te,{children:[e(ne,{children:i(O,{children:[e(P,{className:"text-right",children:"#"}),e(P,{children:"Status"}),!r&&e(P,{children:"Trigger"}),e(P,{children:"Started at"}),e(P,{className:"text-right",children:"Duration"})]})}),e(re,{children:o.map(d=>i(O,{className:"cursor-pointer hover:bg-slate-50 transition-colors",onClick:()=>c(`/pipelines/${d.pipeline_id}/triggers/${d.trigger_id}/runs/${d.id}`),children:[e(R,{className:"text-right",children:d.id}),e(R,{children:e(Oe,{status:d.status})}),!r&&e(R,{children:e($,{to:`/pipelines/${d.pipeline_id}/triggers/${d.trigger_id}`,className:"link--arrow",title:"View trigger details",onClick:f=>f.stopPropagation(),children:d.trigger_id})}),e(R,{children:e(m,{children:Qt(d.start_time)})}),i(R,{className:"text-right",children:[d.status!=="running"?(d.duration/1e3).toFixed(2):e(Xt,{startTime:d.start_time})," ","s"]})]},d.id))})]})]})},Bt=()=>{const n=S({queryKey:["runs",void 0,void 0],queryFn:()=>oe(),initialData:[]});return n.isLoading?e("div",{children:"Loading..."}):n.error?e("div",{children:"An error has occurred"}):e(Q,{header:e(T,{children:e(w,{children:"Mario Pype"})}),children:i(D,{numColsMd:2,className:"gap-6 mt-6",children:[e(Vt,{}),n.isLoading?"Loading...":n.isError?"Error loading runs":e(de,{runs:n.data})]})})},Gt=()=>e("div",{className:"h-screen flex justify-center items-center bg-slate-200",children:i(C,{className:"w-auto",children:[e("div",{className:"w-12 rounded-full mx-auto mb-4",children:e("img",{src:"/mario-pipe-flower.png",alt:"Mario Pype logo"})}),e(w,{className:"mb-6",children:"Welcome to Mario Pype"}),e(N,{onClick:()=>{location.href=`${Lt()}/login`},size:"lg",color:"indigo",className:"shadow-none w-full",children:"Login"})]})}),De=({content:n})=>{const[t,r]=g.useState(!1),o=g.useRef();return e(N,{variant:"light",color:"indigo",size:"sm",icon:t?st:it,onClick:()=>{navigator.clipboard.writeText(n),r(!0),o.current=setTimeout(()=>r(!1),3e3)}})},I=()=>e(m,{children:"/"}),ue=({pipeline:n,trigger:t,run:r})=>{if(r&&!t)throw new Error;return e("div",{className:"breadcrumbs",children:i(v,{className:"space-x-2 justify-start",children:[e(m,{children:e($,{to:"/",children:"Pipelines"})}),e(I,{}),e(m,{children:t?e($,{to:`/pipelines/${n.id}`,children:n.name}):n.name}),t&&i(T,{children:[e(I,{}),e(m,{children:"Triggers"}),e(I,{}),e(m,{children:r?e($,{to:`/pipelines/${n.id}/triggers/${t.id}`,children:t.name}):t.name})]}),r&&t&&i(T,{children:[e(I,{}),e(m,{children:"Runs"}),e(I,{}),i(m,{children:["#",r.id]})]})]})})},ge=n=>(n/1e3).toFixed(1)+" s",Ee=({runs:n})=>{const t=n.filter(o=>o.status==="completed").reverse(),r=t.reduce((o,s)=>o+s.duration,0)/t.length||0;return i(C,{children:[e(v,{className:"items-start",children:e(m,{children:"Duration"})}),e(v,{className:"justify-start items-baseline space-x-3 truncate",children:e(Le,{children:ge(r)})}),e(at,{data:t,index:"id",categories:["duration"],colors:["indigo"],valueFormatter:ge,yAxisWidth:40,showLegend:!1,autoMinValue:!0,className:"mt-6 h-28"})]})},Ie=({runs:n,subject:t})=>{var c,u;const o=n.filter(h=>h.status==="completed").length/n.length*100||0,s=(c=n[0])==null?void 0:c.start_time,a=(u=n[n.length-1])==null?void 0:u.start_time;return i(C,{children:[e(v,{children:i(w,{children:[t," health"]})}),n.length?i(T,{children:[i(v,{className:"mt-4",children:[e(m,{children:"Successful runs"}),i(m,{children:[o.toFixed(1)," %"]})]}),e(ot,{className:"mt-2",data:n.map(h=>({key:h.id,color:U[h.status],tooltip:`#${h.id} ${h.status}`}))})]}):e(m,{className:"text-center mt-8",children:i(ct,{children:["This ",t.toLowerCase()," has no runs yet"]})}),i(v,{className:"mt-2",children:[e(m,{children:s&&s.toDateString()}),e(m,{children:a&&a.toDateString()})]})]})},Ht=({pipeline:n})=>{const t=Ce();return i(C,{children:[e(w,{children:"Triggers"}),i(te,{children:[e(ne,{children:i(O,{children:[e(P,{children:"Name"}),e(P,{children:"Interval"})]})}),e(re,{children:n.triggers.map(r=>i(O,{className:"cursor-pointer hover:bg-slate-50 transition-colors",onClick:()=>t(`/pipelines/${n.id}/triggers/${r.id}`),children:[e(R,{children:r.name}),e(R,{children:e(m,{children:r.schedule})})]},r.id))})]})]})},zt=()=>{const t=se().pipelineId,r=S({queryKey:["pipeline",t],queryFn:()=>ae(t),initialData:{id:"",name:"",description:"",tasks:[],triggers:[]},enabled:!!t}),o=S({queryKey:["runs",t,void 0],queryFn:()=>oe(t),initialData:[]});if(o.isLoading||r.isLoading)return e("div",{children:"Loading..."});if(o.error||r.error)return e("div",{children:"An error has occurred"});const s=r.data;return i(Q,{header:i(v,{className:"items-start",children:[i("div",{children:[i(v,{className:"justify-start space-x-2",children:[i(w,{children:["Pipeline ",s.name]}),s.description&&i(m,{className:"truncate",children:["Â· ",s.description]})]}),e(ue,{pipeline:s})]}),e(le,{pipeline:s})]}),children:[i(D,{numColsMd:2,numColsLg:3,className:"gap-6 mt-6",children:[i(C,{className:"flex flex-col h-full",children:[e(w,{children:"Tasks"}),e(J,{children:s.tasks.map(a=>e(k,{children:i("div",{children:[e(m,{children:e(A,{children:a.name})}),a.description&&e(m,{className:"truncate",children:a.description})]})},a.id))}),e("div",{style:{flexGrow:1}}),i(k,{children:[i(v,{className:"justify-start",children:[e(m,{children:"Run URL"}),e(F,{size:"sm",color:"slate",icon:Pe,tooltip:"URL to run the pipeline programmatically via an HTTP POST request"})]}),i(v,{className:"justify-end",children:[e("div",{className:"bg-slate-100 border-slate-300 rounded border text-slate-500 text-xs truncate px-1 py-0.5 mr-2",style:{maxWidth:200},title:B(t),children:B(t)}),e(De,{content:B(t)})]})]})]}),e(Ie,{subject:"Pipeline",runs:[...o.data].reverse()}),e(Ee,{runs:o.data})]}),i(D,{numCols:1,numColsSm:1,numColsMd:1,numColsLg:2,className:"gap-6 mt-6",children:[e(he,{children:e(Ht,{pipeline:s})}),e(he,{children:e(de,{runs:o.data,pipelineId:t})})]})]})},Yt=({trigger:n})=>{const[t,r]=g.useState(!1);return i(T,{children:[e(N,{color:"indigo",variant:"light",size:"sm",icon:lt,onClick:()=>r(!0),children:"Show params"}),e(W,{isOpen:t,title:"Trigger params",subtitle:n.name,footer:e(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),onClose:()=>r(!1),children:e("pre",{className:"p-3 bg-slate-100 rounded-md",children:JSON.stringify(n.params,null,2)})})]})},j={id:"_manual",name:"Manual",description:"Special trigger that identifies pipelines run manually by the user"},Jt=()=>{const n=se(),t=n.pipelineId,r=n.triggerId,o=S({queryKey:["pipeline",t],queryFn:()=>ae(t),initialData:{id:"",name:"",description:"",tasks:[],triggers:[]},enabled:!!t}),s=S({queryKey:["runs",t,r],queryFn:()=>oe(t,r),initialData:[],enabled:!!r}),a=be({mutationFn:()=>It(t,r)});if(s.isLoading||o.isLoading)return e("div",{children:"Loading..."});if(s.error||o.error)return e("div",{children:"An error has occurred"});const c=o.data,u=r===j.id,h=u?j:c.triggers.find(f=>f.id===r);if(!h)return e("div",{children:"Trigger not found"});const d=u?e(le,{pipeline:c}):e(N,{size:"xs",color:"indigo",icon:xe,onClick:()=>{a.mutateAsync()},children:"Run trigger"});return i(Q,{header:i(v,{className:"items-start",children:[i("div",{children:[i(w,{children:["Trigger ",h.name]}),e(ue,{pipeline:c,trigger:h})]}),d]}),children:[i(D,{numColsMd:2,numColsLg:3,className:"gap-6 mt-6",children:[i(C,{className:"flex flex-col h-full",children:[e(w,{children:h.name}),e(Y,{children:h.description}),e("div",{style:{flexGrow:1}}),i(k,{children:[e(m,{children:"Schedule"}),e(m,{children:e(A,{children:h.schedule})})]}),i(k,{children:[e(m,{children:"Params"}),h.params?e(Yt,{trigger:h}):e(m,{children:e("em",{children:"No params"})})]}),i(k,{children:[i(v,{className:"justify-start",children:[e(m,{children:"Run URL"}),e(F,{size:"sm",color:"slate",icon:Pe,tooltip:"URL to run the trigger programmatically via an HTTP POST request"})]}),i(v,{className:"justify-end",children:[e("div",{className:"bg-slate-100 border-slate-300 rounded border text-slate-500 text-xs truncate px-1 py-0.5 mr-2",style:{maxWidth:200},title:_(t,r),children:_(t,r)}),e(De,{content:_(t,r)})]})]})]}),e(Ie,{subject:"Trigger",runs:[...s.data].reverse()}),e(Ee,{runs:s.data})]}),e("div",{className:"mt-6",children:e(de,{runs:s.data,pipelineId:t,triggerId:r})})]})},Zt=({logEntry:n})=>{const[t,r]=g.useState(!1);return i(v,{className:"mt-1",children:[e(N,{color:"rose",variant:"secondary",size:"xs",onClick:()=>r(!0),children:"Traceback info"}),e(W,{isOpen:t,title:"Traceback info",footer:e(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),maxWidth:"80%",onClose:()=>r(!1),children:e("div",{className:"flex flex-col",children:e("div",{style:{minWidth:350,maxWidth:"100%",overflow:"auto",flexGrow:1,maxHeight:"70vh"},className:"p-3 my-3 bg-slate-100 rounded-md whitespace-pre font-mono",children:n.exc_info})})})]})},fe={DEBUG:"slate",INFO:"sky",WARNING:"amber",ERROR:"rose"},en=({pipeline:n,runId:t})=>{const[r,o]=g.useState({levels:[],tasks:[]}),{lastJsonMessage:s}=ee(ie().toString()),a=Z(),c=S({queryKey:["logs",t],queryFn:()=>Ot(t),enabled:!!t,initialData:[]}),u=g.useCallback(l=>{const{data:y,type:x}=l;x==="logs"&&a.setQueryData(["logs",t],(p=[])=>{const b=JSON.parse(y);return b.id=p.length,b.timestamp=new Date(b.timestamp),[...p,b]})},[t]);g.useEffect(()=>{s&&u(s)},[s]);const h=g.useCallback(l=>{o(y=>({...y,...l}))},[]);if(c.isLoading)return e("div",{children:"Loading..."});if(c.isError)return e("div",{children:"Error loading logs"});const d=c.data.filter(l=>(r.levels.length===0||r.levels.includes(l.level))&&(r.tasks.length===0||r.tasks.includes(l.task))),f=ke(n.tasks);return i(T,{children:[i(D,{numColsMd:3,className:"gap-6",children:[i("div",{children:[e(m,{children:"Tasks"}),e(me,{className:"mt-1",onValueChange:l=>{h({tasks:l})},children:n.tasks.map(l=>e(pe,{text:l.name,value:l.id},l.id))})]}),i("div",{children:[e(m,{children:"Log level"}),e(me,{className:"mt-1",onValueChange:l=>{h({levels:l})},children:Object.keys(fe).map(l=>e(pe,{text:l,value:l},l))})]})]}),e("div",{className:"logs-table",children:i(te,{className:"mt-6",children:[e(ne,{children:i(O,{children:[e(P,{children:"Time"}),e(P,{children:"Level"}),e(P,{children:"Task"}),e(P,{children:"Message"})]})}),e(re,{children:d.map((l,y)=>{const x=y!==0?l.timestamp.getTime()-d[y-1].timestamp.getTime():-1;return i(O,{children:[i(R,{children:[e("span",{className:"font-mono text-xs text-slate-500",children:Wt(l.timestamp)}),x>=0&&i("span",{className:"font-mono text-xs text-slate-500 ml-2",children:["+",x," ms"]})]}),e(R,{children:e(Ne,{size:"xs",color:fe[l.level],children:l.level})}),e(R,{children:i(v,{children:[e("div",{className:`h-2 w-2 mr-2 rounded-full ${f[l.task]}`}),l.task]})}),i(R,{children:[e(m,{children:l.message}),l.exc_info&&e(Zt,{logEntry:l})]})]},l.id)})})]})})]})},tn="modulepreload",nn=function(n){return"/"+n},ye={},rn=function(t,r,o){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(a=>{if(a=nn(a),a in ye)return;ye[a]=!0;const c=a.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(!!o)for(let f=s.length-1;f>=0;f--){const l=s[f];if(l.href===a&&(!c||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${u}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":tn,c||(d.as="script",d.crossOrigin=""),d.href=a,document.head.appendChild(d),c)return new Promise((f,l)=>{d.addEventListener("load",f),d.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t())},sn=Re.lazy(()=>rn(()=>import("./HandsonTable-61c9230e.js"),["assets/HandsonTable-61c9230e.js","assets/vendor-ccd85f8c.js","assets/HandsonTable-a8e02e84.css"])),an=({runId:n,taskId:t,open:r,onClose:o})=>{const s=S({queryKey:["getRunData",{runId:n,taskId:t}],queryFn:()=>Dt(n,t),enabled:r});return e(T,{children:i(W,{title:t,subtitle:"View data",isOpen:r,maxWidth:"90%",minWidth:"90%",footer:e(N,{variant:"secondary",color:"indigo",onClick:()=>o(),children:"Close"}),onClose:o,children:[!s.isLoading&&!s.isError&&e(g.Suspense,{fallback:e("div",{children:"Loading..."}),children:e(sn,{data:s.data,rowHeaders:!0,colHeaders:Object.keys(s.data[0]),height:"70vh",width:"100%",licenseKey:"non-commercial-and-evaluation"})}),s.isError&&(s.error.response.status===404?e(m,{children:"The task has no data"}):i(m,{color:"rose",children:["Error fetching task data: ",s.error.message]}))]})})},on=({pipeline:n,run:t})=>{const[r,o]=g.useState(),s=ke(n.tasks);return i(C,{children:[e(an,{runId:t.id,taskId:r||"",open:!!r,onClose:()=>o(void 0)}),e(w,{children:"Tasks"}),e(J,{children:n.tasks.map((a,c)=>{var u;return i(k,{className:"space-x-4",children:[t.tasks_run[c]?e(F,{variant:"light",icon:G[t.tasks_run[c].status],color:U[t.tasks_run[c].status]}):e(F,{variant:"light",icon:G.notrun,color:U.notrun}),i("div",{className:"truncate flex-grow",children:[i(v,{className:"justify-start",children:[e("div",{className:`h-2 w-2 mr-2 rounded-full ${s[a.id]}`}),e(m,{className:"truncate",children:e(A,{children:a.name})})]}),a.description&&e(m,{className:"truncate",children:a.description})]}),((u=t.tasks_run[c])==null?void 0:u.has_output)&&e(N,{variant:"light",color:"indigo",size:"xs",icon:dt,onClick:()=>o(a.id),children:"Data"})]},a.id)})})]})},cn=()=>{const{lastJsonMessage:n}=ee(ie().toString()),t=Z(),r=se(),o=r.pipelineId,s=r.triggerId,a=parseInt(r.runId);g.useEffect(()=>{if(n){const{data:p,type:b}=n;b==="run-update"&&t.invalidateQueries({queryKey:["run",o,s,a]}).catch(()=>{})}},[n,o]);const c=S({queryKey:["pipeline",o],queryFn:()=>ae(o),initialData:{id:"",name:"",description:"",tasks:[],triggers:[]},enabled:!!o}),u=S({queryKey:["run",o,s,a],queryFn:()=>kt(a),enabled:!!(o&&s&&a)}),h=c.data,f=s===j.id?j:h.triggers.find(p=>p.id===s),l=u.data;if(!l)return e("div",{children:"Run not found"});if(!f)return e("div",{children:"Trigger not found"});const y=(l.tasks_run||[]).reduce((p,b)=>p+b.duration,0),x=(l.tasks_run||[]).map(p=>p.duration/y*100);return i(Q,{header:i(T,{children:[i(w,{children:["Run #",a]}),e(ue,{pipeline:h,trigger:f,run:l})]}),children:[i(D,{numColsMd:3,className:"gap-6 mt-6",children:[e(on,{pipeline:h,run:l}),i(C,{children:[i(v,{className:"items-start",children:[e(m,{children:"Duration"}),e(Oe,{status:l.status})]}),e(v,{className:"justify-start items-baseline space-x-3 truncate",children:i(Le,{children:[(l.duration/1e3).toFixed(1),"s"]})}),e(ut,{categoryPercentageValues:x,colors:H,showLabels:!1,className:"mt-3"})]})]}),e("div",{className:"mt-6",children:e(C,{children:e(en,{pipeline:h,runId:a})})})]})},ln=({children:n})=>{const{isAuthenticated:t,isLoading:r}=ce(),o=ht();return!t&&!r?e(mt,{to:"/login",replace:!0,state:{from:o}}):e(T,{children:n})},dn=Object.assign({"./pages/index.tsx":Bt,"./pages/login.tsx":Gt,"./pages/pipelines/[pipelineId]/index.tsx":zt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/index.tsx":Jt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/runs/[runId]/index.tsx":cn}),un=Object.entries(dn).map(([n,t])=>{const r=n.slice(7).replace(/(index)?\.tsx$/,"").split("/").map(o=>o.replace(/\[(.+)\]/,":$1")).join("/");return{path:r,element:r!=="/login"?e(ln,{children:e(t,{})}):e(t,{})}}),hn=()=>e(pt,{children:un.map(n=>e(gt,{path:n.path,element:n.element},n.path))}),mn=new ft({defaultOptions:{queries:{retry:!1}}});function pn(){return e(yt,{client:mn,children:e(vt,{children:e(At,{children:e(hn,{})})})})}bt.createRoot(document.getElementById("root")).render(e(Re.StrictMode,{children:e(pn,{})}));export{e as j};
